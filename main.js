const e=document.getElementById("amount"),k=document.getElementById("cps_shop_items"),l=document.getElementById("shop_items"),n=document.getElementById("tap_power"),p=document.getElementById("cps"),q=document.getElementById("upgrades_count"),r=document.getElementById("change_keys"),t=document.getElementById("keys"),u=document.getElementById("main");v("All elements are not null",!!e&&!!k&&!!l&&!!n&&!!k&&!!q&&!!r&&!!t&&!!u);
const x=(a,b)=>{var c=w.i.s;return`Tap ${0>=c?"?":a.toUpperCase()}/${1>=c?"?":b.toUpperCase()} to gain points.`};function v(a,b){if(!b)throw Error("Assertion failed: "+a);}
function y(a,b,c,d){const g=document.createElement("li"),f=document.createElement("div"),h=document.createElement("p");a=document.createTextNode(`${a.name}, ${a.h}${"pp"}`);const m=document.createElement("button");b=document.createTextNode(b);h.setAttribute("id","p"+c);m.setAttribute("id",c);g.setAttribute("id","list_"+c);m.onclick=d;m.appendChild(a);f.appendChild(m);h.appendChild(b);f.appendChild(h);g.appendChild(f);return g}
function z(a){const b=Array(a.l.length).fill(1);for(const c in a.v){if(0===a.g[c])continue;const d=a.v[c];if("multiplier"===d?.action.type)for(const g in d.action.D){const f=d.action.D[g];b[f]=b[f]*a.g[f]*d.action.value}}return b}function A(a){const b=z(a);v("multipliers is valid length",b.length===a.l.length);return a.u.map((c,d)=>c*b[d]*a.l[d].o).reduce((c,d)=>c+d)}
class B{constructor(){this.l=[{id:0,name:"Logitech",h:80,o:.4},{id:1,name:"Left click",h:340,o:1},{id:2,name:"A drill",h:1860,o:4},{id:3,name:"Vaxei",h:8420,o:10},{id:4,name:"Cookiezi",h:44500,o:50}];this.v=[{id:0,name:"Buldak",m:"Very spicy. +0.6 tap power",h:520,action:{type:"tap_power",value:.6}},{id:1,name:"Better wire",m:"Logitech is twice more effective.",h:840,action:{type:"multiplier",D:[0],value:2}},{id:2,name:"Mousepad",m:"Less mouse drift. +1.2 tap power",h:1300,action:{type:"tap_power",
value:1.2}},{id:3,name:"Wacom",m:"+3.2 tap power",h:4600,action:{type:"tap_power",value:3.2}},{id:4,name:"Power outlet",m:"Left click and drill become twice as effective.",h:10640,action:{type:"multiplier",D:[1,2],value:2}},{id:5,name:"Sugar",m:"Vaxei becomes twice as effective.",h:18900,action:{type:"multiplier",D:[3],value:2}},{id:6,name:"Tablet cover",m:"Click power is doubled.",h:23200,action:{type:"tap_power_multiplier",value:2}},{id:7,name:"Cookiezi comeback",m:"Cookiezi becomes twice as effective.",
h:69420,action:{type:"multiplier",D:[4],value:2}}];this.u=Array(this.l.length).fill(0);this.g=Array(this.v.length).fill(0)}I(a){this.g[a.id]+=1;document.getElementById("item"+a.id).disabled=!0;this.H();this.G()}J(a){this.u[a.id]+=1;this.l[a.id].h=Math.floor(1.15*this.l[a.id].h);this.G()}H(){for(const a in this.g){const b=this.v[a];0<this.g[a]&&(document.getElementById("item"+b.id).disabled=!0);0<this.g[parseInt(a)-1]&&(document.getElementById("list_item"+b.id).hidden=!1)}}G(){const a=z(this);for(const c in this.u){const d=
this.l[c],g=document.getElementById("cps_item"+d.id),f=document.getElementById("pcps_item"+d.id);var b=this.u[d.id];b=0<b?`| You have ${b}, producing ${(d.o*b*a[d.id]).toFixed(1)} ${"pp"}/s`:"";g.textContent=`${d.name}, ${d.h}${"pp"}`;f.textContent=`+${d.o*a[d.id]} ${"pp"}/s\n${b}`;0<this.u[parseInt(c)-1]&&(document.getElementById("list_cps_item"+d.id).hidden=!1)}}}function C(a){var b=w;a.C||(a.C=!0,b.g.A+=1,b.amount+=b.L,b.g.K=!0,clearInterval(b.g.N),b.g.N=setTimeout(()=>{b.g.K=!1},1E3))}
function D(a){const b=a.F+36*a.g.A/a.g.B;e.textContent=Math.floor(a.amount).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g,",")+"pp";p.textContent="pp/s: "+b.toFixed(1).replace(/\B(?=(\d{3})+(?!\d))/g,",")+" ("+Math.floor(60*b/4)+" BPM)";n.textContent="Tap power: "+a.L;q.textContent="Upgrades bought: "+a.j.u.reduce((c,d)=>c+d,0)}
class E{constructor(){var a=F;this.M=(new Date).getTime();this.g={N:0,K:!1,A:0,B:40};this.amount=0;this.L=1;this.F=0;this.j=a;this.i={keys:[{key:"z",C:!1},{key:"x",C:!1}],s:-1}}J(a){const b=this;return function(){b.amount<a.h?alert('Not enough pp to buy "'+a.name+'" :('):(b.amount-=a.h,b.j.J(a),b.G(),b.F=A(b.j))}}I(a){const b=this;return function(){if(b.amount<a.h)alert('Not enough pp to buy "'+a.name+'" :(');else{b.amount-=a.h;b.j.I(a);b.H();var c=b.j;let d=1,g=1;for(const f in c.g){if(0===c.g[f])continue;
const h=c.v[f];switch(h?.action.type){case "tap_power":d+=h.action.value*c.g[f];break;case "tap_power_multiplier":g*=h.action.value*c.g[f]}}b.L=d*g;b.F=A(b.j)}}}G(){this.j.G()}H(){this.j.H()}}const F=new B,w=new E;var G=w;for(const a in G.j.l){const b=G.j.l[a],c=y(b,`+${b.o} ${"pp"}/s`,"cps_item"+b.id,G.J(b));0<parseInt(a)&&(c.hidden=!0);k.appendChild(c)}for(const a in G.j.v){const b=G.j.v[a],c=y(b,b.m,"item"+b.id,G.I(b));0<parseInt(a)&&(c.hidden=!0);l.appendChild(c)}
v("settings.keys is of KEY_COUNT size",2===w.i.keys.length);setInterval(()=>{var a=w;a.amount+=a.F/40;a.g.K?a.g.B+=1:40!=a.g.B?(a.g.A=Math.floor(a.g.A/a.g.B*36),a.g.B=40):0<a.g.A&&--a.g.A;D(a)},25);document.addEventListener("keydown",a=>{const b=w.i.keys[0],c=w.i.keys[1];if(0<=w.i.s)w.i.keys[w.i.s].key=a.key,w.i.s+=1,t.textContent=x(b.key,c.key),2<=w.i.s&&(w.i.s=-1,r.textContent="Change keys...");else switch(a.key.toLowerCase()){case b.key:C(b);break;case c.key:C(c)}});
document.addEventListener("keyup",a=>{const b=w.i.keys[0],c=w.i.keys[1];switch(a.key.toLowerCase()){case b.key:b.C=!1;break;case c.key:c.C=!1}});r.onclick=()=>{const a=w.i.keys[0],b=w.i.keys[1];w.i.s=0;t.textContent=x(a.key,b.key);r.textContent="Press new a new key..."};window.onfocus=()=>{const a=(new Date).getTime()-w.M;1E3<a&&(w.amount+=a/1E3*w.F)};window.onblur=()=>{w.M=(new Date).getTime()};
